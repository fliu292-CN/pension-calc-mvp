<van-toast id="van-toast" />

<view class="page-header">
  <view class="title">养老金计算器</view>
  <view class="subtitle">全国省市最新基数 · 叙叙推演精算</view>
</view>

<view class="container">
  <van-cell-group inset custom-class="input-card">
    <van-cell title="参保城市" value="{{ city }}" is-link bind:click="showCityPopup" />

    <van-cell title="性别">
      <van-radio-group value="{{ gender }}" direction="horizontal" bind:change="onGenderChange">
        <van-radio name="male">男</van-radio>
        <van-radio name="female">女</van-radio>
      </van-radio-group>
    </van-cell>

    <van-field
      label="当前年龄"
      value="{{ age }}"
      type="number"
      placeholder="例如 30"
      bind:change="onAgeChange"
    />

    <van-field
      label="退休年龄"
      value="{{ retireAge }}"
      type="number"
      placeholder="男60 / 女55"
      bind:change="onRetireAgeChange"
    />

    <van-field
      label="已缴年限"
      value="{{ years }}"
      type="number"
      placeholder="例如 5"
      right-icon="question-o"
      bind:change="onYearsChange"
      bind:click-icon="onShowYearsHelp"
    />

    <van-field
      label="账户余额"
      value="{{ balance }}"
      type="number"
      placeholder="个人账户当前余额"
      left-icon="gold-coin-o"
      bind:change="onBalanceChange"
    />

    <van-field
      label="税前月薪"
      value="{{ salary }}"
      type="number"
      placeholder="当前税前工资"
      left-icon="balance-list-o"
      bind:change="onSalaryChange"
    />

    <van-cell center title="开启涨薪预测 (年涨3%)">
      <van-switch slot="right-icon" checked="{{ useGrowth }}" bind:change="onGrowthChange" size="24px" />
    </van-cell>

  </van-cell-group>

  <view class="btn-area">
    <van-button round block type="primary" size="large" bind:click="onSubmit">
      开始计算
    </van-button>
  </view>

  <van-popup
    show="{{ showCity }}"
    position="bottom"
    round
    bind:close="onCityCancel"
  >
    <van-picker
      wx:if="{{ showCity }}"
      show-toolbar
      title="选择地区"
      columns="{{ cityColumns }}"
      default-index="{{ defaultCityIndex }}"
      visible-item-count="{{ 5 }}"
      bind:cancel="onCityCancel"
      bind:confirm="onCityConfirm"
    />
  </van-popup>

  <view wx:if="{{ result }}" class="result-card" id="result-section">
    <view class="result-title">
      预估月领 ({{ useGrowth ? '含涨薪预测' : '保守估算' }})
    </view>
    <view class="result-amount">¥ {{ result.detail.total_pension }}</view>

    <van-cell-group>
      <van-cell title="基础养老金" value="¥ {{ result.detail.basic_pension }}" />
      <van-cell title="个人账户养老金" value="¥ {{ result.detail.account_pension }}" />
      <van-cell title="退休时账户余额" value="¥ {{ result.detail.final_balance }}" />
      <van-cell title="缴费指数" value="{{ result.detail.avg_index }}" />
    </van-cell-group>

    <!-- 🌟 新增：计算过程叙事 -->
    <view class="process-box">
      <view class="process-title">精算结果解读</view>
      <view class="process-content">
        <block wx:for="{{ processText }}" wx:key="index">
          <view class="process-p">{{ item }}</view>
        </block>
      </view>
    </view>

    <!-- 🌟 新增：核心公式展示 -->
    <view class="formula-box">
      <view class="formula-title">精算公式说明</view>
      <view class="formula-item">
        <text class="formula-label">基础养老金 =</text>
        <text class="formula-val">(退休时计发基数 + 本人指数化月薪) ÷ 2 × 缴费年限 × 1%</text>
      </view>
      <view class="formula-item">
        <text class="formula-label">个人账户养老金 =</text>
        <text class="formula-val">个人账户存储额 ÷ 计发月数</text>
      </view>
    </view>

  </view>

  <view class="feedback-area">
    <van-button open-type="feedback" icon="edit" plain hairline type="default" size="small" round>
      意见反馈
    </van-button>
  </view>

  <view class="disclaimer">
    免责声明：本工具计算结果仅供参考，不作为官方社保核算依据。<br/>
    实际金额请以当地社保局核算为准。
  </view>

</view>